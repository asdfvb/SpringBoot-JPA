# SpringBoot-JPA
## 영속성 컨텍스트 (PersistenceContext)

- "엔티티를 영구 저장하는 환경" 이라는 뜻
- EntityManager를 통해서 영속성 컨텍스트에 접근 가능
  (EntityManager 1 : 1 PersistenceContext) 관계

<br>

### ► 1차 캐시
- em.find(), em.update() ... 등 메소드 실행시 디비에 바로 적용하지 않고 영속성 컨텍스트에서 해당 객체의 @Id로 지정된 키값이 있는지 찾아서 있으면 디비에서 찾지 않고 바로 가져온다.
  
- 만약 영속성 컨텍스으세 없는 값을 조회시 디비에서 조회해온후 영속성 컨텍스트에 1차캐시에 등록후 결과를 반환해준다.

### ► 영속성엔티티의 동일성 보장
- 영속성 컨텍스트에서 관리중인 키의 
- c객체를 여러번 반복 사용해도 다른값을 가지지 않는다.

### ► 트랜잭션을 지원하는 쓰기 지연
- em.persist() 메소드 실행시 먼저 1차 캐시에 객체를 등록한후, '쓰기 지연 SQL저장소'에 Insert쿼리를 생성하여 저장만 시켜놓는다.
- '쓰기 지연 SQL저장소'에 쌓인 쿼리들은 Transaction.commit() 메소드 실행과 동시에 데이터베이스에 날린다.(flush)

### ► 변경 감지
- 객체가 영속성 컨텍스트에 가장 처음 1차캐시에 등록될때 생성되는 값(@Id 키값, 객체, 객체 스냅샷(원본))
- 영속성 컨텍스트에서 가져온 객체를 수정할 경우 '객체.setName(변경값)'을 실행시 Transaction.commit()메소드 실행 시점에 객체와 객체 스냅샷을 비교하여 변경된 값을 업데이트 쿼리작성하여 '쓰기 지연 SQL저장소'에 저장한다. 



  